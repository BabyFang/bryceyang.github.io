<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>Arch linux安装过程整理</title>
  <meta name="description" content="整理一下这个教程便于以后可以无脑重装Arch Linux，美滋滋啊。">
  <meta name="author" content="Wei Wang">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Arch linux安装过程整理">
  <meta name="twitter:description" content="整理一下这个教程便于以后可以无脑重装Arch Linux，美滋滋啊。">
  
  <meta property="og:type" content="article">
  <meta property="og:title" content="Arch linux安装过程整理">
  <meta property="og:description" content="整理一下这个教程便于以后可以无脑重装Arch Linux，美滋滋啊。">
  
  <link rel="icon" type="image/png" href="/assets/images/favicon.png" />
  <link href="/assets/images/favicon.png" rel="shortcut icon" type="image/png">
  
  <link rel="stylesheet" href="/css/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/2017/05/Arch-Linux%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B%E6%95%B4%E7%90%86/">
  <link rel="alternate" type="application/rss+xml" title="V" href="http://localhost:4000/feed.xml">
  
  <meta name="google-site-verification" content="1-1ZlHoRvM0T2FqPbW2S-qLgYXN6rsn52kErlMPd_gw" />
  
</head>


  <body>

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/assets/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/#blog" title="前往 V 的主页" class="blog-button"><img src="/assets/images/avatar.jpg" width="80" alt="V logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for V" class="blog-button">V</a></h1>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">V is my learning record.</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        
        <p class="panel-cover__description"><a href="https://github.com/bryceyang" target="_blank">Welcome</a></p>
        
        
        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="Visit blog" class="blog-button">Blog</a></li>
                
              </ul>
            </nav>
          </div>
          
          <div><nav class="cover-navigation navigation--social">
  <ul class="navigation">

  
  <!-- Weibo -->
  <li class="navigation__item">
    <a href="http://weibo.com/poplar40" title="@poplar40 的微博" target="_blank">
      <i class='social fa fa-weibo'></i>
      <span class="label">Weibo</span>
    </a>
  </li>
  

  
  <!-- Github -->
  <li class="navigation__item">
    <a href="https://github.com/bryceyang" title="@bryceyang 的 Github" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>
  
  
  
  <!-- Twitter -->
  <li class="navigation__item">
    <a href="http://twitter.com/poplar50" title="@poplar50" target="_blank">
      <i class='social fa fa-twitter'></i>
      <span class="label">Twitter</span>
    </a>
  </li>
  

  
  <!-- Google Plus -->
  <li class="navigation__item">
    <a href="https://plus.google.com/108486653827211515463" rel="author" title="Google+" target="_blank">
      <i class='social fa fa-google-plus-square'></i>
      <span class="label">Google Plus</span>
    </a>
  </li>
  

  <!-- RSS -->
  <li class="navigation__item">
    <a href="/feed.xml" rel="author" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>

  
  <!-- Email -->
  <li class="navigation__item">
    <a href="mailto:kaieryang@hotmail.com" title="Contact me">
      <i class='social fa fa-envelope'></i>
      <span class="label">Email</span>
    </a>
  </li>
  
  </ul>
</nav>

</div>
<span id="busuanzi_container_site_uv">
  您是第<span id="busuanzi_value_site_uv"></span>位访客
</span>
        </div>
      </div>
    </div>
    
    
    <div class="panel-cover--overlay cover-disabled"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2017-05-24 19:32:00 +0800" itemprop="datePublished" class="post-meta__date date">2017-05-24</time> &#8226; <span class="post-meta__tags tags">Linux</span><span id="busuanzi_container_page_pv">  本文总阅读量<span id="busuanzi_value_page_pv"></span>次</span>
    </div>
    <h1 class="post-title">Arch linux安装过程整理</h1>
  </header>

  <section class="post">
    <p><strong>整理一下这个教程便于以后可以无脑重装Arch Linux，美滋滋啊。</strong></p>

<h3 id="准备以及分区">准备以及分区</h3>

<p><strong>1.准备</strong></p>

<ul>
  <li>
    <p>准备内容</p>

    <ol>
      <li>
        <p>USB stick</p>
      </li>
      <li>
        <p>Arch Linux ISO image</p>
      </li>
    </ol>

    <p><a href="https://www.archlinux.org/download/">Arch Linux Download Addr</a></p>
  </li>
  <li>
    <p>创建启动盘</p>

    <ol>
      <li>
        <p>On windows: Rufus</p>
      </li>
      <li>
        <p>On linux: <code class="highlighter-rouge">sudo dd if=/path_to_arch_.iso of=/dev/sdx</code></p>
      </li>
    </ol>
  </li>
</ul>

<blockquote>
  <p>sdx代表你的U盘，可以用lsblk命令查看得到。</p>
</blockquote>

<p>接下来就是设置bios启动方式，教程基于UEFI+GPT的引导启动方式。请自行设置。</p>

<p><strong>设置USB为下一次的引导路径，然后重启之后我们就能进入Arch安装环境了</strong></p>

<p>查看EFI mode是否开启</p>

<p><code class="highlighter-rouge">efivar -l</code></p>

<p>如果有输出，就说明已经开启。</p>

<p><strong>2.分区</strong></p>

<p><code class="highlighter-rouge">lsblk</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code>gdisk /dev/sdx (x representing your drive)
x          # into expert mode
z          # clear the disk
y          # confirm
y          # confirm
</code></pre>
</div>
<p>创建分区</p>

<p><strong>分区设定如下：</strong></p>

<p>sda</p>

<ul>
  <li>
    <p>sda1(boot partition)</p>
  </li>
  <li>
    <p>sda2(our swap partition)</p>
  </li>
  <li>
    <p>sda3(our root partition)</p>
  </li>
  <li>
    <p>sda4(our home partition)</p>
  </li>
</ul>

<p><strong>使用cgdisk分区：</strong></p>

<p><code class="highlighter-rouge">cgdisk /dev/sdx</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code>[New] Press Enter
First Sector: Leave this blank -&gt;press Enter
Size in sectors: 1024MiB -&gt;press Enter
Hex Code: EF00 press Enter
Enter new partition name: boot -&gt;press Enter
</code></pre>
</div>
<p><strong>boot分区</strong>的Hex Code为<strong>EF00</strong>，千万不要弄错，有些资料会说是EF02，实测EF00才有效。</p>

<p>arch wiki上说boot分区分配200-300mb就行了，但是为了以后的双系统等未知需求，分配1Gb。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[New] Press Enter
First Sector: Leave this blank -&gt;press Enter
Size in sectors: 8GiB -&gt;press Enter
Hex Code: 8200 -&gt;press Enter
Enter new partition name: swap -&gt;press Enter
</code></pre>
</div>
<p><strong>swap分区</strong>的Hex Code是<strong>8200</strong>。</p>

<p>swap分区的开启与否以及大小设置一直是争论焦点。这里贴出参考：</p>

<p><a href="https://askubuntu.com/questions/49109/i-have-16gb-ram-do-i-need-32gb-swap/49130#49130">askubuntu_swap</a></p>

<p><a href="https://serverfault.com/questions/5841/how-much-swap-space-on-a-2-4gb-system">serverfault_swap</a></p>

<p>下面建立root分区和home分区。两者Hex code都是默认的<strong>8300</strong>。
如果不独立设置home分区，就可以直接把剩余空间都设置为root分区。
如果设置独立的home分区，可以分配30G左右给root分区，剩余空间分配给home分区。
分区全部建立完毕之后，我们就要设置分区格式了。</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>mkfs.fat -F32 /dev/sda1
mkswap /dev/sda2
swapon /dev/sda2
mkfs.ext4 /dev/sda3
mkfs.ext4 /dev/sda4
</code></pre>
</div>

<h3 id="3安装arch-以及配置启动">3.安装Arch 以及配置启动</h3>

<p>挂载分区</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>mount /dev/sda3 /mnt
mkdir /mnt/boot
mkdir /mnt/home
mount /dev/sda1 /mnt/boot
mount /dev/sda4 /mnt/home
</code></pre>
</div>

<p>设置mirrorlist</p>

<blockquote>
  <p>学校有ipv6的学生可以用清华的源，ipv6直连，美滋滋。</p>
</blockquote>

<p><code class="highlighter-rouge">nano /etc/pacman.d/mirrorlist</code></p>

<p>然后在最前面加上</p>

<div class="highlighter-rouge"><pre class="highlight"><code># Tsinghua
Server = http://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch
</code></pre>
</div>
<p>然后安装系统</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pacstrap -i /mnt base base-devel
</code></pre>
</div>

<p>然后创建fstab文件到新安装系统：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>genfstab -U -p /mnt &gt;&gt; /mnt/etc/fstab
</code></pre>
</div>

<p>可以通过<code class="highlighter-rouge">nano /mnt/etc/fstab</code>查看是否创建成功</p>

<p><strong>接下来就可以切换到我们新安装的系统了</strong></p>

<p><code class="highlighter-rouge">arch-chroot /mnt</code></p>

<p>接下来设置语言，linux下界面语言还是用英文吧。</p>

<p><code class="highlighter-rouge">nano /etc/locale.gen</code></p>

<p>然后取消掉<code class="highlighter-rouge">en_US.UTF-8</code>和<code class="highlighter-rouge">zh_CN.UTF-8</code>前面的注释。</p>

<p>使其生效：</p>

<p><code class="highlighter-rouge">locale-gen</code></p>

<p>接下来设置语言：</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="nb">echo </span><span class="nv">LANG</span><span class="o">=</span>en_US.UTF-8 &gt; /etc/locale.conf
<span class="nb">export </span><span class="nv">LANG</span><span class="o">=</span>en_US.UTF-8
</code></pre>
</div>

<p>设置时区：</p>

<p><code class="highlighter-rouge">ln -s /usr/share/zoneinfo/Asia/Shanghai &gt; /etc/localtime</code></p>

<p>请自觉使用tab补全以免出错。</p>

<p>设置硬件时钟：</p>

<p><code class="highlighter-rouge">hwclock --systohc --utc</code></p>

<p>设置主机名：</p>

<p><code class="highlighter-rouge">echo hostname &gt; /etc/hostname</code></p>

<p>然后编辑<code class="highlighter-rouge">pacman.conf</code>取消multilib前面的注释：</p>

<p>这个是为了在64位机器上运行32位程序</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[multilib]
Include = /etc/pacman.d/mirrorlist
</code></pre>
</div>

<p>然后强烈推荐添加的yaourt</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[archlinuxfr]
SigLevel = Never
Server = http://repo.archlinux.fr/$arch
</code></pre>
</div>
<p>一定要注意大小写。</p>

<p>必须添加的archlinuxcn源，里面有很多中国特色软件，比如网易云、有道词典之类的，同样推荐清华源。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[archlinuxcn]
SigLevel = Optional TrustedOnly
Server = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/$arch
</code></pre>
</div>
<p>然后安装<code class="highlighter-rouge">archlinuxcn-keyring</code>包以导入GPG key。</p>

<p>这个时候就可以保存<code class="highlighter-rouge">pacman.conf</code>文件了。</p>

<p>设置root账户的密码：</p>

<p><code class="highlighter-rouge">passwd</code></p>

<p>添加日常用户：</p>

<p><code class="highlighter-rouge">useradd -m -g users -G wheel,storage,power -s /bin/bash yourusername</code></p>

<p>设置密码：</p>

<p><code class="highlighter-rouge">passwd yourusername</code></p>

<p>然后是设置sudoers：</p>

<p><code class="highlighter-rouge">EDITOR=nano visudo</code></p>

<p>然后取消注释：</p>

<p><code class="highlighter-rouge">%wheel ALL=(ALL) ALL</code></p>

<p>然后让使用sudo命令的用户必须输入root密码：</p>

<p><code class="highlighter-rouge">Defaults rootpw</code></p>

<p>然后就可以保存文件了。</p>

<p>安装补全命令：</p>

<p><code class="highlighter-rouge">pacman -S bash-completion</code></p>

<ul>
  <li>安装引导</li>
</ul>

<p>确保EFI变量被挂载</p>

<p><code class="highlighter-rouge">mount -t efivarfs efivarfs /sys/firmware/efi/efivars</code></p>

<p>使用Gummiboot作为我们的启动管理，这个已经整合到了bootctl/system-boot里，所以安装方式为：</p>

<p><code class="highlighter-rouge">bootctl install</code></p>

<p>下面，我需要把/root分区的PARTUUID加入到启动设置里：</p>

<p><code class="highlighter-rouge">blkid -s PARTUUID -o value /dev/sdxY</code></p>

<p>x代表设备代号，本次为a，Y是/root partition的排号，本次为3.</p>

<p>然后添加gummiboot manager配置文件：</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>nano /boot/loader/entries/arch.conf
<span class="c"># 下面是内容：</span>
title Arch Linux
linux /vmlinuz-linux
initrd /initramfs-linux.img
options <span class="nv">root</span><span class="o">=</span><span class="nv">PARTUUID</span><span class="o">=</span>上个命令得到的 rw
</code></pre>
</div>

<p>保存并退出</p>

<p>添加intel支持：</p>

<p><code class="highlighter-rouge">pacman -S intel-ucode</code></p>

<p>然后写入到启动管理设置里：</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>nano /boot/loader/entries/arch.conf
initrd /intel-ucode.img
initrd /initramfs-linux.img
</code></pre>
</div>

<p>这个时候基本的操作已经完成了，我们可以重启试试了。</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="nb">exit
</span>umount -R /mnt
reboot
</code></pre>
</div>
<h3 id="5安装xfce4桌面环境">5.安装xfce4桌面环境</h3>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>sudo pacman -S mesa
sudo pacman -S xorg-server xorg-server-common xorg-xinit
sudo pacman -S xfce4
sudo pacman -S xfce4-goodies
sudo pacman -S sddm
sudo systemctl <span class="nb">enable </span>sddm.service
reboot
</code></pre>
</div>
<p>安装完成，可以使用了。美滋滋。</p>

<h3 id="6安装tex-live">6.安装Tex Live</h3>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>yaourt -S texlive-most
yaourt -S texlive-langchinese
yaourt -S texstudio
</code></pre>
</div>
<p>安装完成之后使用<code class="highlighter-rouge">tex --version</code>测试：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>-&lt;%&gt;- tex --version
TeX 3.14159265 (TeX Live 2016/Arch Linux)
kpathsea version 6.2.2
Copyright 2016 D.E. Knuth.
There is NO warranty.  Redistribution of this software is
covered by the terms of both the TeX copyright and
the Lesser GNU General Public License.
For more information about these matters, see the file
named COPYING and the TeX source.
Primary author of TeX: D.E. Knuth.
</code></pre>
</div>
<p>使用texstudio编写测试文件：</p>

<p>新建test.tex,内容如下：</p>

<div class="language-latex highlighter-rouge"><pre class="highlight"><code><span class="k">\documentclass</span><span class="p">{</span>article<span class="p">}</span>

<span class="k">\usepackage</span><span class="p">{</span>graphicx<span class="p">}</span>

<span class="nt">\begin{document}</span>

<span class="nt">\begin{figure}</span>
  <span class="k">\includegraphics</span><span class="na">[width=\linewidth]</span><span class="p">{</span>favicon.jpg<span class="p">}</span>
  <span class="k">\caption</span><span class="p">{</span>A boat.<span class="p">}</span>
  <span class="k">\label</span><span class="p">{</span>fig:boat1<span class="p">}</span>
<span class="nt">\end{figure}</span>

Figure <span class="k">\ref</span><span class="p">{</span>fig:boat1<span class="p">}</span> shows a boat.

<span class="nt">\end{document}</span>
</code></pre>
</div>
<p>Build &amp; View查看运行结果，正常结果如下：</p>

<p><img src="http://oq782gkz3.bkt.clouddn.com/favicon.png" alt="results" /></p>


  </section>
</article>

<section class="read-more">
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">最近的文章</span>
       <h2 class="post-list__post-title post-title"><a href="/2017/05/Tips/" title="link to Tips about git and jupyter">Tips about git and jupyter</a></h2>
       <p class="excerpt">git push 免密码1.使用文件创建用户名和密码文件创建在用户主目录下：touch .git-credentialsvim .git-credentialshttps://{username}:{password}@github.com记得在真正输入的时候是没有大括号的。2.添加git config内容git config --global credential.helper store执行此命令后，用户主目录下的.gitconfig文件会多了一项：[credential]helper...&hellip;</p>
       <div class="post-list__meta"><time datetime="2017-05-24 23:41:00 +0800" class="post-list__meta--date date">2017-05-24</time> &#8226; <span class="post-list__meta--tags tags">Tips</span><a class="btn-border-small" href=/2017/05/Tips/>继续阅读</a></div>
   </div>
   
   
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">更早的文章</span>
       <h2 class="post-list__post-title post-title"><a href="/2017/05/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/" title="link to 正则表达式入门">正则表达式入门</a></h2>
       <p class="excerpt">这是主要参考文献：正则表达式入门，本文只是做了修改以便于自己记忆。1. 元字符 metacharater  \b 代表着单词的开头或者结尾，也就是单词的分界处；  . 匹配除了换行符以外的任意字符；  \d 匹配一位数字；  \s 匹配任意的空白符，包括空格，制表符，换行符，中文全角空格等；  \w 匹配字母或数字或下划线或者汉字等；  ^  匹配字符串的开始；  $  匹配字符串的结束；字符转义仍然是使用\2. 限定  + 指定前面的内容可以连续重复1次或者更多次；  * 指定前面的内容...&hellip;</p>
       <div class="post-list__meta"><time datetime="2017-05-20 14:43:00 +0800" class="post-list__meta--date date">2017-05-20</time> &#8226; <span class="post-list__meta--tags tags">Linux</span><a class="btn-border-small" href=/2017/05/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/>继续阅读</a></div>
   </div>
   
</section>

<section class="post-comments">
  
    <div id="disqus_thread"></div>
    <script>
    
    var disqus_config = function () {
        this.page.url = "http://localhost:4000/2017/05/Arch-Linux%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B%E6%95%B4%E7%90%86/";
        this.page.identifier = "/2017/05/Arch-Linux%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B%E6%95%B4%E7%90%86/";
    };

    var disqus_shortname = 'bryceyang';
    
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>要查看<a href="http://disqus.com/?ref_noscript"> Disqus </a>评论，请启用 JavaScript</noscript>
    
  
  
  
  
</section>


            <section class="footer">
    <footer>
        <span class="footer__copyright">Powered by Jekyll&Github - &copy; 2017 Bryce Yang</span>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<script type="text/javascript" src="/js/main.js"></script>



    
  </body>

</html>
